<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>购物车</title>
    <link href="images/favicon.ico" type="image/x-icon" rel="icon"/><!-- 图标 -->
    <script src="js/head.js"></script>
    <script src="js/vue.min.js"></script>
    <script src="js/axios.min.js"></script>
</head>
<body>
<div id="cartitem">
    <table>
        <tr>
            <th>序号</th>
            <th>商品</th>
            <th>单价</th>
            <th>数量</th>
            <th>小计</th>
            <th>操作</th>
        </tr>
        <tr v-for="(value,key) in cartItemList">
            <td>{{key+1}}</td>
            <td>{{cartItemList[key].prodectname}}</td>
            <td>{{cartItemList[key].listprice}}</td>
            <td>{{cartItemList[key].qty}}</td>
            <td>{{cartItemList[key].listprice*cartItemList[key].qty}}</td>
            <td>
                <button :data-id="cartItemList[key].id" @click="deleteCart(cartItemList[key].id)">删除</button>
            </td>
        </tr>
    </table>
    <button @click="toHome()">继续购物</button>
    <button @click="toPay()">立即购买</button>
</div>
<script>
    new Vue({
        el: '#cartitem',
        data: {
            cartItemList: [],
        },
        mounted() {
            var _this = this;
            axios.get("/cartItem/getCartItems").then(function (res) {
                console.log(res.data.data);
                _this.cartItemList = res.data.data;
            }).catch(function (reason) {
                console.log(reason);
            })
        },
        methods: {
            // 删除购物车中的商品
            deleteCart(id) {
                var b = confirm("是否要从购物车中删除该商品？");
                if (b) {
                    axios.get("/cartItem/deleteCartItem?id=" + id).then(function (res) {
                        if (res.data.code === 0) {
                            alert(res.data.msg);
                        } else {
                            window.location.href = "cart.html";
                        }
                    }).catch(function (reason) {
                        console.log(reason);
                    })
                }
            },
            // 跳转到主页，购物页面
            toHome() {
                window.location.href = "home.html";
            },
            // 提交订单
            toPay() {
                alert("暂无功能！");
            }
        }
    })
</script>
</body>
</html>
